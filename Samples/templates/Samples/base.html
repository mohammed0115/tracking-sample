<!DOCTYPE html>
<html lang="{% if LANGUAGE_CODE == 'ar' %}ar{% else %}en{% endif %}" dir="{% if LANGUAGE_CODE == 'ar' %}rtl{% else %}ltr{% endif %}">
<head>
    {% load i18n %}
    <meta charset="UTF-8">
    <title>{% block title %}{% trans "Sample Tracking" %}{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    :root{
      --blue:#4f8df7;
      --blue-2:#3b82f6;
      --green:#22c55e;
      --green-2:#34b399;
      --red:#ef4444;
      --bg:#f4f6fb;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --border:#e5e7eb;
      --radius:16px;
    }
    *{box-sizing:border-box;font-family:"Cairo",sans-serif}
    body{margin:0;background:var(--bg);color:var(--text)}

    /* Layout */
    .layout{display:flex;min-height:100vh;direction:ltr}
    .sidebar{direction:rtl;width:260px;background:#fff;padding:28px 20px;box-shadow:0 10px 30px rgba(0,0,0,.06)}
    .main{direction:rtl;flex:1;padding:30px 40px}

    /* Sidebar */
    .sidebar h3{margin:0 0 28px 0;font-size:18px}
    .lang-switch{margin:10px 0 18px 0}
    .lang-switch select{width:100%;padding:8px;border-radius:10px;border:1px solid var(--border);background:#fff}
    .sidebar .avatar{display:flex;align-items:center;gap:12px;margin-bottom:22px;position:relative}
    .sidebar .avatar-img{width:44px;height:44px;border-radius:50%;object-fit:cover;border:2px solid #e5e7eb}
    .sidebar .avatar-name{font-size:14px;color:#1f2937}
    .sidebar .avatar-menu{position:absolute;top:52px;right:0;background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,.08);padding:8px;min-width:160px;display:none;z-index:10}
    .sidebar .avatar.open .avatar-menu{display:block}
    .sidebar .avatar-menu a{display:block;padding:8px 10px;border-radius:8px;text-decoration:none;color:#374151;font-size:13px}
    .sidebar .avatar-menu a:hover{background:#f3f4f6}
    .sidebar .avatar-menu button{width:100%;border:none;background:transparent;text-align:right;padding:8px 10px;border-radius:8px;color:#374151;font-size:13px;cursor:pointer}
    .sidebar .avatar-menu button:hover{background:#f3f4f6}
    .sidebar a{display:block;padding:12px 16px;margin-bottom:10px;border-radius:12px;text-decoration:none;color:#374151;font-size:14px;display:flex;align-items:center;gap:10px}
    .sidebar a i{width:20px;text-align:center;color:#9ca3af;font-size:14px}
    .sidebar a.active,.sidebar a:hover{background:#eef2ff;color:var(--blue)}
    .sidebar a.active i,.sidebar a:hover i{color:var(--blue)}

    /* Headings */
    h1{margin:0 0 20px 0;font-size:28px}
    h2{margin:0 0 16px 0}
    h3{margin:0 0 14px 0}

    /* Cards */
    .card{background:#fff;padding:20px;border-radius:var(--radius);box-shadow:0 12px 30px rgba(0,0,0,.06)}
    .card + .card{margin-top:20px}

    /* Buttons */
    .btn{border:none;padding:10px 18px;border-radius:10px;cursor:pointer;font-size:14px;display:inline-flex;align-items:center;gap:6px}
    .btn-blue{background:var(--blue);color:#fff}
    .btn-green{background:var(--green);color:#fff}
    .btn-red{background:var(--red);color:#fff}
    .btn-gray{background:#e5e7eb;color:#374151;text-decoration:none}
    .btn:disabled{opacity:.5;cursor:not-allowed}

    /* Badges */
    .status{padding:6px 14px;border-radius:999px;color:#fff;font-size:12px;display:inline-block}
    .status.pending{background:var(--blue)}
    .status.checked{background:#0ea5e9}
    .status.approved{background:var(--green)}
    .status.rejected{background:var(--red)}

    /* Forms */
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input, select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);font-size:14px;background:#fff}

    /* Tables */
    table{width:100%;border-collapse:collapse}
    thead{background:#f1f5f9}
    th,td{padding:12px 10px;text-align:center;font-size:14px}
    tbody tr:not(:last-child){border-bottom:1px solid #eee}

    /* Utilities */
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
    .grid-main{display:grid;grid-template-columns:1.2fr 2fr;gap:24px}
    .muted{color:var(--muted)}
    .spacer{height:16px}

    /* Dashboard cards */
    .action-card{color:#fff;padding:18px;border-radius:var(--radius);display:flex;justify-content:space-between;align-items:center;font-weight:600}
    .action-card.green{background:linear-gradient(135deg,#6ee7b7,#34b399)}
    .action-card.blue{background:linear-gradient(135deg,#60a5fa,#3b82f6)}

    .stat-card{display:flex;justify-content:space-between;align-items:center;padding:14px;border-bottom:1px solid #eee}
    .stat-card:last-child{border-bottom:none}
    .stat-card strong{font-size:22px;color:var(--green)}

    /* Filters */
    .filters{display:grid;grid-template-columns:1fr 1fr 1fr 1.2fr auto;gap:16px;align-items:end}
    .filters .btn{height:42px}

    /* Pagination */
    .pagination{display:flex;gap:8px;justify-content:center;margin-top:16px}
    .page{background:#fff;border:1px solid var(--border);padding:6px 12px;border-radius:8px}

    /* RFID box */
    .rfid-box{border:2px dashed #c7d2fe;border-radius:14px;padding:18px;text-align:center}
    .log{max-height:150px;overflow:auto;font-size:13px}
    .log div{border-bottom:1px solid #eee;padding:6px 0}

    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:999}
    .modal.show{display:flex}
    .modal-card{background:#fff;border-radius:16px;box-shadow:0 12px 30px rgba(0,0,0,.2);padding:24px;min-width:360px}
    .modal-card h3{margin-bottom:14px}
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
<div class="layout">
    {% if request.user.is_authenticated %}
    <aside class="sidebar">
        <div class="avatar" id="avatarMenu">
            {% if request.user.userprofile.avatar %}
                <img class="avatar-img" alt="avatar" src="{{ request.user.userprofile.avatar.url }}">
            {% else %}
                <img class="avatar-img" alt="avatar" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'><rect width='80' height='80' fill='%23e0e7ff'/><circle cx='40' cy='30' r='14' fill='%236474ff'/><path d='M14 72c6-16 19-24 26-24s20 8 26 24' fill='%236474ff'/></svg>">
            {% endif %}
            <div class="avatar-name">{{ request.user.get_full_name|default:request.user.username }}</div>
            <div class="avatar-menu">
                <a href="{% url 'profile_edit' %}">{% trans "Edit Profile" %}</a>
                <button type="button" id="openLangModal">{% trans "Change Language" %}</button>
                <a href="/users/logout/">{% trans "Logout" %}</a>
            </div>
        </div>
        <h3>{% trans "Control Panel" %}</h3>
        <a href="{% url 'dashboard' %}" class="{% if '/api/dashboard/' in request.path %}active{% endif %}"><i class="fas fa-chart-line"></i>{% trans "Dashboard" %}</a>
        <a href="/api/samples/web/" class="{% if '/api/samples/web/' in request.path %}active{% endif %}"><i class="fas fa-list"></i>{% trans "Sample List" %}</a>
        <a href="/api/samples/add/" class="{% if '/api/samples/add/' in request.path %}active{% endif %}"><i class="fas fa-plus"></i>{% trans "Add Sample" %}</a>
        <a href="{% url 'reports' %}" class="{% if '/api/reports/' in request.path %}active{% endif %}"><i class="fas fa-chart-bar"></i>{% trans "Reports" %}</a>
        {% if request.user.is_superuser %}
            <a href="{% url 'user_management' %}" class="{% if '/users/management/' in request.path %}active{% endif %}"><i class="fas fa-users"></i>{% trans "User Management" %}</a>
        {% endif %}
        <a href="/users/logout/"><i class="fas fa-sign-out-alt"></i>{% trans "Logout" %}</a>
    </aside>
    {% endif %}
    <main class="main" style="width:100%;">
        {% block content %}{% endblock %}
        <div class="spacer"></div>
        <div class="muted" style="text-align:center;font-size:12px;padding:10px 0;">
            {% trans "© 2026 GSC. All rights reserved for GetSolution Co" %}
        </div>
    </main>
</div>

<div class="modal" id="langModal">
    <div class="modal-card">
        <h3>{% trans "Select Language" %}</h3>
        <div style="display:flex;gap:12px;margin-top:16px;">
            <form action="/i18n/setlang/" method="post" style="flex:1;">
                {% csrf_token %}
                <input type="hidden" name="language" value="ar">
                <input type="hidden" name="next" value="{{ request.path }}">
                <button class="btn btn-blue" style="width:100%;" type="submit">العربية</button>
            </form>
            <form action="/i18n/setlang/" method="post" style="flex:1;">
                {% csrf_token %}
                <input type="hidden" name="language" value="en">
                <input type="hidden" name="next" value="{{ request.path }}">
                <button class="btn btn-blue" style="width:100%;" type="submit">English</button>
            </form>
        </div>
    </div>
</div>
{% block extra_js %}{% endblock %}
<script>
    const avatarMenu = document.getElementById('avatarMenu');
    if (avatarMenu) {
        const menu = avatarMenu.querySelector('.avatar-menu');
        avatarMenu.addEventListener('click', function (e) {
            if (menu && menu.contains(e.target)) {
                return;
            }
            e.stopPropagation();
            avatarMenu.classList.toggle('open');
        });
        if (menu) {
            menu.addEventListener('click', function (e) {
                e.stopPropagation();
            });
        }
        document.addEventListener('click', function () {
            avatarMenu.classList.remove('open');
        });
    }

    const openLangModal = document.getElementById('openLangModal');
    const langModal = document.getElementById('langModal');
    if (openLangModal && langModal) {
        openLangModal.addEventListener('click', function (e) {
            e.stopPropagation();
            langModal.classList.add('show');
        });
        langModal.addEventListener('click', function (e) {
            if (e.target === langModal) {
                langModal.classList.remove('show');
            }
        });
    }
</script>
</body>
</html>